## JavaScript加性操作符详解

[JavaScript Addition Operator in Details](https://dmitripavlutin.com/javascriptss-addition-operator-demystified/)

JavaScript是一门很棒的语言。我喜欢它是因为它的灵活性，你可以按照你喜欢的方式做事：改变变量类型，动态地给对象添加方法或属性，对不同类型变量使用操作符等等。

但是，这种灵活是有代价的。开发人员要会如何处理不同操作符的类型转换：加（`+`）、相等（`==`和`===`）、不等（`!=`和`!==`）等。许多操作符有自己的方式来处理类型转换。

#### 加性操作符
最常用的运算符之一是加性运算符：`+`，加性运算符被用来拼接字符串或数字求和：
1. 字符串拼接：
```javascript
var result = "Hello, " + "World!";
// string + string = string (concatenation)
// "Hello, World!"
```
2. 数字算术求和：
```javascript
var result = 10 + 5;
// number + number = number (addition)
// 15
```

JavaScript允许使用对象、数组、`null`、`undefined`作为操作数。让我们搞清楚转换的一般规则吧。

#### 转换规则
以下面的等式为例来看一下JavaScript在加性操作中是如何转换类型的：

`操作数 + 操作数 = 结果` 
1. <span id="jump2">如果至少有一个操作数是对象，则将其转换为原始值（字符串、数字、布尔类型）；</span>
2. <span id="jump1">转换过后，如果至少有一个操作数是字符串类型，则将第二个操作数转换成字符串类型并执行拼接操作；</span>
3. <span id="jump3">其他情况下，两个操作数都被转换为数字类型并执行算术求和。</span>

如果两个操作数都是原始类型，操作符会检查是否存在字符串类型值，如果存在，执行拼接操作。其他情况则一律转换为数字并求和。

#### 对象转原始值
对象到原始值转换：

- 如果对象类型是日期，那么使用`toString()`方法；
- 其他情况下使用`valueOf()`方法，如果返回的是原始值；
- 其他情况（如果不存在`valueOf`方法或不返回原始值），那么使用`toString()`方法。多数都是这种情况。

当数组转换为原始值时，JavaScript使用`join(',')`方法，例如`[1, 5, 6]`的转换为原始值为`"1, 5, 6"`。原生JavaScript对象`{}`原始值是`"[object Object]"`。

#### 举例
以下示例有助于理解规则转换的简单情况和复杂情况。

##### 例1：数字和字符串
`var result = 1 + "5"; // "15"`

解释：

1. `1 + "5"`（第二个操作数是字符串，基于[规则2](#jump1)数字`1`变成`"1"`）
2. `"1" + "5"`（字符串拼接）
3. `"15"`
第二个操作数是一个字符串，第一个操作数从数字转换为字符串然后拼接起来。

##### 例2：数字和数组
`var result = [1, 3, 5] + 1; // "1, 3, 51"`

解释：

1. `[1, 3, 5] + 1`（根据[规则1](#jump2)，将数组`[1, 3, 5]`转换为原始值`"1, 3, 5"`）
2. `"1, 3, 5" + 1`（根据[规则2](#jump1)，将数字`1`转换成字符串`"1"`）
3. `"1, 3, 5" + "1"`（字符串拼接）
4. `"1, 3, 51"`
第一个操作数是数组，所以被转换为原始字符串值。接下来数字操作数被转换成字符串。然后两个字符串拼接起来。

##### 例3：数字和布尔值
`var result = 10 + true; // 11`

解释：

1. `10 + true`（根据[规则3](#jump3)将布尔值`true`转换为数字`1`）
2. `10 + 1`（两数之和）
3. `11`
由于两个操作数都不是字符串，布尔值被转换为数字。然后执行算术求和。

##### 例4：数字和对象
`var result = 15 + {}; // "15[objext Object]"`

解释：
1. `15 + {}`（第二个操作数是对象，根据[规则1](#jump2)，对象转换为字符串`"[object Object]"`）
2. `15 + "[object Object]"`（根据[规则2](#jump1)将数字`15`转换为字符串`15`）
3. `"15" + "[object Object]"`（字符串拼接）
4. `"15[object Object]"`

第二个操作数是对象被转换成字符串值，因为`valueOf()`方法返回对象自身而不是一个原始值，因此调用`toString()`方法。第二个操作数现在是一个字符串，因此数字也被转换成字符串，然后执行字符串拼接。

##### 例5：数字和`null`
`var result = 8 + null; // 8`

解释：

1. `8 + null`（因为操作数都不是字符串，所以根据[规则3](#jump3)将`null`转换为数字`0`）
2. `8 + 0`（数字相加）
3. `8`

因为操作数既不是对象也不是字符串，所以`null`被转换为数字，然后计算数字求和。

##### 例6：字符串和`null`
`var result = "queen" + null; // "queennull"

解释：

1. `"queen" + null`（第一个操作数是字符串，因此根据[规则2](#jump1)将`null`转换为一个字符串`"null"`）
2. `"queen" + "null"`（字符串拼接）
3. `"queennull"`

因为第一个操作数是字符串，`null`被转换为字符串，然后执行字符串拼接。

##### 例7：数字和`undefined`
`var result = 12 + undefined; // NaN`

解释：

1. `12 + undefined`（操作数都不是字符串，因此根据[规则3](#jump3)将`undefined`转换为`NaN`）
2. `12 + NaN`（数字求和）
3. `NaN`

因为操作数既不是对象也不是字符串，所以`undefined`被转换成数字`NaN`，任何数字加`NaN`结果都是`NaN`。

#### 结论
除非明确定义了`toString()`或`valueOf`方法，否则为了避免潜在的问题，请不要对对象使用加性运算符。正如前文的例子所示，加性操作符有许多特殊情况，了解特定的转换方案能帮助你以后避免意外发生。
